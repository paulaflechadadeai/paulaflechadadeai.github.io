<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hadas Malvadas ¬∑ paulaflechadadeai ¬∑ TikTok + YouTube</title>
    <style>
        /* Mismos estilos base, solo se a√±ade .youtube-container */
        :root {
            --neon-green: #00ff00;
            --neon-pink: #ff00ff;
            --neon-blue: #00aaff;
            --hada-pink: #ff88ff;
            --hada-purple: #cc66ff;
            --bg-dark: #0a0a0a;
            --bg-darker: #000;
        }

        body {
            font-family: 'Courier New', monospace;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: var(--bg-dark);
            color: var(--neon-green);
            line-height: 1.6;
            background-image: radial-gradient(circle at 10% 20%, rgba(255, 0, 255, 0.05) 0%, transparent 20%),
                              radial-gradient(circle at 90% 80%, rgba(255, 136, 255, 0.05) 0%, transparent 20%);
        }

        .header {
            border-bottom: 2px dashed var(--hada-pink);
            padding-bottom: 15px;
            margin-bottom: 30px;
            position: relative;
        }

        .glitch-title {
            font-size: clamp(1.8em, 5vw, 2.8em);
            color: var(--hada-pink);
            text-shadow: 3px 0 var(--hada-purple), -2px 0 var(--neon-green);
            animation: glitch 3s infinite;
            margin: 0;
        }

        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            10% { transform: translate(-3px, 1px); }
            20% { transform: translate(2px, -2px); }
            30% { transform: translate(-2px, 3px); }
            40% { transform: translate(1px, -1px); }
        }

        .subheader {
            color: var(--hada-pink);
            margin: 10px 0 0 0;
            font-size: 1em;
        }

        .terminal {
            background: var(--bg-darker);
            border: 2px solid var(--hada-pink);
            padding: 20px;
            margin: 30px 0;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.2);
        }

        .terminal-line {
            margin: 12px 0;
            font-family: 'Courier New', monospace;
        }

        .prompt { color: var(--hada-pink); font-weight: bold; }
        .cmd { color: var(--hada-purple); }
        .output { color: var(--neon-green); margin-left: 15px; }

        button {
            background: black;
            border: 2px solid;
            padding: 8px 16px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px currentColor;
        }

        .btn-primary { color: var(--hada-pink); border-color: var(--hada-pink); }
        .btn-secondary { color: var(--hada-purple); border-color: var(--hada-purple); }
        .btn-danger { color: #ff5555; border-color: #ff5555; }
        .btn-warning { color: #ffaa00; border-color: #ffaa00; }

        input, select, textarea {
            background: black;
            color: var(--neon-green);
            border: 2px solid var(--hada-pink);
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            width: 100%;
            margin-bottom: 15px;
            border-radius: 4px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--hada-purple);
            box-shadow: 0 0 10px var(--hada-purple);
        }

        label {
            color: var(--hada-pink);
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 5px;
            margin-bottom: 5px;
            color: black;
        }

        .tag-hadas { background: #ff88ff; }
        .tag-avistamientos { background: #cc66ff; }
        .tag-cazas { background: #ff55ff; }

        .entrada {
            border-left: 6px solid #ff88ff;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 0 8px 8px 0;
        }

        .entrada-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .entrada-titulo {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--hada-pink);
        }

        .entrada-fecha {
            color: var(--hada-purple);
            font-size: 0.85em;
        }

        .entrada-tags {
            margin: 10px 0;
        }

        .entrada-contenido {
            color: var(--neon-green);
            white-space: pre-wrap;
            border-top: 1px dashed #333;
            border-bottom: 1px dashed #333;
            padding: 15px 0;
            margin: 15px 0;
        }

        /* Contenedor TikTok (altura fija) */
        .tiktok-container {
            position: relative;
            width: 100%;
            margin: 20px 0;
            background: black;
            border-radius: 8px;
            overflow: hidden;
        }

        .tiktok-container iframe {
            width: 100%;
            height: 600px;
            border: none;
        }

        /* Contenedor YouTube (16:9) */
        .youtube-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 */
            margin: 20px 0;
            background: black;
            border-radius: 8px;
            overflow: hidden;
        }

        .youtube-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .url-preview {
            color: var(--hada-pink);
            font-size: 0.8em;
            word-break: break-all;
            margin: 5px 0;
            padding: 5px;
            background: rgba(0,0,0,0.5);
        }

        .contador-mes {
            background: rgba(255, 136, 255, 0.1);
            border: 1px solid var(--hada-pink);
            padding: 10px;
            text-align: center;
            font-size: 1.2em;
            margin: 20px 0;
        }

        .filtros {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
            justify-content: center;
        }

        .filtro-btn {
            background: black;
            border: 2px solid;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 20px;
        }

        .filtro-btn.activo {
            background: var(--hada-pink);
            color: black;
        }

        .volver {
            margin: 20px 0;
        }
        .volver a {
            color: var(--hada-pink);
            text-decoration: none;
            font-weight: bold;
        }
        .volver a:hover { color: var(--hada-purple); }

        @media (max-width: 768px) {
            body { padding: 10px; }
            .tiktok-container iframe { height: 400px; }
        }

        .platform-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
            margin-left: 10px;
            text-transform: uppercase;
            background: var(--bg-darker);
            border: 1px solid currentColor;
        }
        .platform-tiktok { color: #ff0050; }
        .platform-youtube { color: #ff0000; }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="glitch-title">~/hadasmalvadas $</h1>
        <p class="subheader">> Cazando hadas en TikTok y YouTube ¬∑ 10 por mes ¬∑ Sin sponsors</p>
    </div>

    <div class="volver">
        <a href="/">‚Üê INICIO</a> ¬∑ 
        <a href="/observatorio">‚Üê OBSERVATORIO</a>
    </div>

    <!-- ===== PANEL EDITOR ===== -->
    <div id="panelEditor" style="display: none;" class="terminal">
        <div class="terminal-line">
            <span class="prompt">$</span> <span class="cmd">caza_hadas --activar</span>
        </div>
        
        <form id="formEditor" onsubmit="event.preventDefault(); guardarEntrada();">
            <div>
                <label>üìå T√çTULO:</label>
                <input type="text" id="editTitulo" placeholder="Ej: Hada avistada en live" required>
            </div>
            
            <div>
                <label>üè∑Ô∏è TAG:</label>
                <select id="editTag" required>
                    <option value="hadas">üßö HADAS MALVADAS</option>
                    <option value="avistamientos">üîç AVISTAMIENTOS</option>
                    <option value="cazas">‚öîÔ∏è CAZAS EXITOSAS</option>
                </select>
            </div>
            
            <div>
                <label>üîó URL DEL VIDEO (TikTok o YouTube):</label>
                <input type="url" id="editVideoUrl" 
                       placeholder="https://www.tiktok.com/@hada/video/123456789  o  https://youtu.be/abcd1234" 
                       required>
                <small style="color: var(--hada-pink);" id="plataformaDetectada"></small>
            </div>
            
            <div id="vistaPreviaTiktok" style="display: none; margin: 15px 0; text-align: center;">
                <p style="color: var(--hada-pink);" id="mensajeDetectado">üßö ¬°Hada detectada!</p>
                <div class="url-preview" id="urlPreview"></div>
            </div>
            
            <div>
                <label>üìù NOTAS DE CAZA (opcional):</label>
                <textarea id="editContenido" rows="3" placeholder="Describe c√≥mo identificaste al hada..."></textarea>
            </div>
            
            <!-- Campos ocultos para la edici√≥n -->
            <input type="hidden" id="editId" value="">
            <input type="hidden" id="editPlataforma" value="">
            <input type="hidden" id="editVideoId" value="">
            
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button type="submit" class="btn-primary">üíæ REGISTRAR HADA</button>
                <button type="button" onclick="cancelarEdicion()" class="btn-secondary">‚úñ CANCELAR</button>
            </div>
        </form>
    </div>

    <!-- ===== BOTONES DE CONTROL ===== -->
    <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: space-between; margin: 20px 0;">
        <button onclick="mostrarEditor()" id="btnMostrarEditor" class="btn-secondary">
            üîß MODO CAZADORA
        </button>
        <button onclick="nuevoMes()" id="btnNuevoMes" class="btn-warning">
            üìÖ NUEVO MES (limpiar registro)
        </button>
    </div>

    <!-- ===== CONTADOR ===== -->
    <div class="contador-mes" id="contadorMes">
        Cargando...
    </div>

    <!-- ===== FILTROS ===== -->
    <div class="filtros">
        <button onclick="filtrarPorTag('todas')" id="filtro-todas" class="filtro-btn" style="border-color: var(--hada-pink); color: var(--hada-pink);">üìã TODAS</button>
        <button onclick="filtrarPorTag('hadas')" id="filtro-hadas" class="filtro-btn" style="border-color: #ff88ff; color: #ff88ff;">üßö HADAS</button>
        <button onclick="filtrarPorTag('avistamientos')" id="filtro-avistamientos" class="filtro-btn" style="border-color: #cc66ff; color: #cc66ff;">üîç AVISTAMIENTOS</button>
        <button onclick="filtrarPorTag('cazas')" id="filtro-cazas" class="filtro-btn" style="border-color: #ff55ff; color: #ff55ff;">‚öîÔ∏è CAZAS</button>
    </div>

    <!-- ===== CONTENEDOR DE VIDEOS ===== -->
    <div class="terminal">
        <div class="terminal-line">
            <span class="prompt">$</span> <span class="cmd">hadas --registro</span>
            <span id="contadorVideos" style="color: var(--hada-pink); margin-left: 15px;">(0/10)</span>
        </div>
        
        <div id="contenedorVideos" style="margin: 20px 0; min-height: 200px;">
            <p style="color: var(--hada-pink); text-align: center;">Cargando registro de hadas...</p>
        </div>
    </div>

    <div class="footer">
        <p>üìç Registro de Hadas Malvadas ¬∑ 10 videos por mes ¬∑ Peg√° la URL y a cazar</p>
        <p style="color: var(--hada-pink);">üßö‚Äç‚ôÄÔ∏è "Las hadas existen, solo hay que saber d√≥nde mirar"</p>
    </div>

    <script>
        // ============================================
        // ===== CONFIGURACI√ìN =====
        // ============================================
        // ‚ö†Ô∏è IMPORTANTE: Este archivo ser√° procesado por GitHub Actions
        // La l√≠nea de abajo ser√° REEMPLAZADA autom√°ticamente durante el despliegue
        const CLAVE_EDITOR = String.fromCharCode(112, 97, 116, 105, 116, 111, 49, 50, 51);
        const MAX_ENTRADAS_POR_MES = 10;
        
        let todosLosVideos = [];
        let editorActivo = false;
        let filtroActivo = "todas";
        
        // ============================================
        // ===== FUNCIONES DE EXTRACCI√ìN =====
        // ============================================
        function extraerTikTokId(url) {
            if (!url) return null;
            if (/^\d+$/.test(url)) return url;
            
            const patrones = [
                /video\/(\d+)/,
                /\/embed\/(\d+)/,
                /\/player\/v1\/(\d+)/,
                /tiktok\.com\/.*?(\d{10,})/
            ];
            
            for (let patron of patrones) {
                const match = url.match(patron);
                if (match) return match[1];
            }
            return null;
        }
        
        function extraerYouTubeId(url) {
            if (!url) return null;
            const patrones = [
                /youtube\.com\/watch\?v=([^&]+)/,
                /youtu\.be\/([^?]+)/,
                /youtube\.com\/embed\/([^?]+)/,
                /youtube\.com\/shorts\/([^?]+)/
            ];
            for (let patron of patrones) {
                const match = url.match(patron);
                if (match) return match[1];
            }
            return null;
        }
        
        function detectarPlataforma(url) {
            if (extraerTikTokId(url)) return "tiktok";
            if (extraerYouTubeId(url)) return "youtube";
            return null;
        }
        
        // ============================================
        // ===== GENERADOR DE EMBED =====
        // ============================================
        function generarEmbed(plataforma, videoId) {
            if (!videoId) return '<p style="color: red;">‚ùå Hada perdida, ID inv√°lido</p>';
            
            if (plataforma === "tiktok") {
                return `
                    <div class="tiktok-container">
                        <iframe 
                            src="https://www.tiktok.com/player/v1/${videoId}?music_info=1&description=1"
                            allow="fullscreen"
                            loading="lazy">
                        </iframe>
                    </div>
                `;
            } else if (plataforma === "youtube") {
                return `
                    <div class="youtube-container">
                        <iframe 
                            src="https://www.youtube.com/embed/${videoId}"
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen
                            loading="lazy">
                        </iframe>
                    </div>
                `;
            } else {
                return '<p style="color: red;">‚ùå Plataforma no soportada</p>';
            }
        }
        
        // ============================================
        // ===== FUNCIONES DE DATOS =====
        // ============================================
        function cargarVideos() {
            const guardados = localStorage.getItem('hadasMalvadas');
            if (guardados) {
                let parsed = JSON.parse(guardados);
                // Migrar datos antiguos (sin plataforma) al nuevo formato
                todosLosVideos = parsed.map(v => {
                    if (!v.plataforma) {
                        // Es un video antiguo de TikTok
                        v.plataforma = "tiktok";
                        v.videoId = v.tiktokId;
                        v.url = v.tiktokUrl;
                    }
                    return v;
                });
            } else {
                // Datos de ejemplo con ambos formatos (uno TikTok y otro YouTube demo)
                todosLosVideos = [
                    {
                        id: Date.now() - 86400000,
                        titulo: "Primer hada avistada (TikTok)",
                        tag: "hadas",
                        contenido: "Apareci√≥ en un live de madrugada",
                        tiktokUrl: "https://www.tiktok.com/@scout2015/video/6718335390845095173",
                        tiktokId: "6718335390845095173",
                        plataforma: "tiktok",
                        videoId: "6718335390845095173",
                        url: "https://www.tiktok.com/@scout2015/video/6718335390845095173",
                        fecha: formatearFecha(new Date(Date.now() - 86400000)),
                        timestamp: Date.now() - 86400000
                    },
                    {
                        id: Date.now() - 172800000,
                        titulo: "Hada en YouTube (demo)",
                        tag: "avistamientos",
                        contenido: "Video de ejemplo de YouTube (no es un hada real)",
                        url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
                        plataforma: "youtube",
                        videoId: "dQw4w9WgXcQ",
                        fecha: formatearFecha(new Date(Date.now() - 172800000)),
                        timestamp: Date.now() - 172800000
                    }
                ];
            }
            ordenarVideos();
            guardarVideos(); // guarda ya migrados
            actualizarContadorMes();
            mostrarVideos(todosLosVideos);
        }
        
        function guardarVideos() {
            localStorage.setItem('hadasMalvadas', JSON.stringify(todosLosVideos));
            actualizarContadorMes();
        }
        
        function ordenarVideos() {
            todosLosVideos.sort((a, b) => b.timestamp - a.timestamp);
        }
        
        function formatearFecha(fecha) {
            const dia = fecha.getDate().toString().padStart(2, '0');
            const mes = (fecha.getMonth() + 1).toString().padStart(2, '0');
            const a√±o = fecha.getFullYear();
            const horas = fecha.getHours().toString().padStart(2, '0');
            const minutos = fecha.getMinutes().toString().padStart(2, '0');
            return `${dia}/${mes}/${a√±o} ${horas}:${minutos}`;
        }
        
        // ============================================
        // ===== FUNCIONES DEL EDITOR =====
        // ============================================
        function mostrarEditor() {
            const clave = prompt("üîë Clave de cazadora:");
            
            if (clave === CLAVE_EDITOR) {
                editorActivo = true;
                document.getElementById('panelEditor').style.display = 'block';
                document.getElementById('btnMostrarEditor').style.display = 'none';
                // Limpiar formulario
                document.getElementById('editId').value = "";
                document.getElementById('editTitulo').value = "";
                document.getElementById('editTag').value = "hadas";
                document.getElementById('editContenido').value = "";
                document.getElementById('editVideoUrl').value = "";
                document.getElementById('editPlataforma').value = "";
                document.getElementById('editVideoId').value = "";
                document.getElementById('vistaPreviaTiktok').style.display = 'none';
                document.getElementById('plataformaDetectada').innerText = "";
                
                if (filtroActivo === "todas") {
                    mostrarVideos(todosLosVideos);
                } else {
                    filtrarPorTag(filtroActivo);
                }
            } else if (clave !== null) {
                alert("‚ùå Clave incorrecta");
            }
        }
        
        function ocultarEditor() {
            editorActivo = false;
            document.getElementById('panelEditor').style.display = 'none';
            document.getElementById('btnMostrarEditor').style.display = 'inline-block';
            
            if (filtroActivo === "todas") {
                mostrarVideos(todosLosVideos);
            } else {
                filtrarPorTag(filtroActivo);
            }
        }
        
        function cancelarEdicion() {
            ocultarEditor();
        }
        
        // Detecci√≥n en tiempo real al escribir la URL (opcional)
        document.getElementById('editVideoUrl')?.addEventListener('input', function(e) {
            const url = e.target.value;
            const plataforma = detectarPlataforma(url);
            const msg = document.getElementById('plataformaDetectada');
            if (plataforma === 'tiktok') {
                msg.innerText = 'üì± Plataforma detectada: TikTok';
                msg.style.color = '#ff0050';
            } else if (plataforma === 'youtube') {
                msg.innerText = '‚ñ∂Ô∏è Plataforma detectada: YouTube';
                msg.style.color = '#ff0000';
            } else {
                msg.innerText = '';
            }
        });
        
        // ============================================
        // ===== GUARDAR VIDEO (CREAR O EDITAR) =====
        // ============================================
        function guardarEntrada() {
            const id = document.getElementById('editId').value;
            const titulo = document.getElementById('editTitulo').value.trim();
            const tag = document.getElementById('editTag').value;
            const contenido = document.getElementById('editContenido').value.trim();
            const url = document.getElementById('editVideoUrl').value.trim();
            
            if (!titulo || !url) {
                alert("‚ö†Ô∏è T√≠tulo y URL son obligatorios");
                return;
            }
            
            const plataforma = detectarPlataforma(url);
            if (!plataforma) {
                alert("‚ùå No se pudo detectar la plataforma. Aseg√∫rate de que sea un enlace v√°lido de TikTok o YouTube.");
                return;
            }
            
            let videoId = null;
            if (plataforma === "tiktok") {
                videoId = extraerTikTokId(url);
            } else if (plataforma === "youtube") {
                videoId = extraerYouTubeId(url);
            }
            
            if (!videoId) {
                alert("‚ùå No se pudo extraer el ID del video de la URL.");
                return;
            }
            
            // Verificar l√≠mite solo si es nueva entrada
            if (!id && todosLosVideos.length >= MAX_ENTRADAS_POR_MES) {
                alert(`‚ö†Ô∏è L√≠mite de ${MAX_ENTRADAS_POR_MES} hadas por mes alcanzado`);
                return;
            }
            
            const ahora = new Date();
            
            if (id) {
                // Editar existente
                const index = todosLosVideos.findIndex(v => v.id == id);
                if (index !== -1) {
                    todosLosVideos[index] = {
                        ...todosLosVideos[index],
                        titulo,
                        tag,
                        contenido,
                        url,
                        plataforma,
                        videoId,
                        // Mantenemos compatibilidad con campos antiguos
                        tiktokUrl: plataforma === 'tiktok' ? url : null,
                        tiktokId: plataforma === 'tiktok' ? videoId : null,
                    };
                }
                alert("‚úÖ Registro de hada actualizado");
            } else {
                // Nuevo
                const nuevoVideo = {
                    id: Date.now(),
                    titulo,
                    tag,
                    contenido,
                    url,
                    plataforma,
                    videoId,
                    // compatibilidad
                    tiktokUrl: plataforma === 'tiktok' ? url : null,
                    tiktokId: plataforma === 'tiktok' ? videoId : null,
                    fecha: formatearFecha(ahora),
                    timestamp: ahora.getTime()
                };
                todosLosVideos.unshift(nuevoVideo);
                alert("üßö ¬°Hada registrada con √©xito!");
            }
            
            ordenarVideos();
            guardarVideos();
            
            if (filtroActivo === "todas") {
                mostrarVideos(todosLosVideos);
            } else {
                filtrarPorTag(filtroActivo);
            }
            
            ocultarEditor();
        }
        
        // ============================================
        // ===== MOSTRAR VIDEOS =====
        // ============================================
        function mostrarVideos(videos) {
            const contenedor = document.getElementById('contenedorVideos');
            const contadorSpan = document.getElementById('contadorVideos');
            
            if (!videos || videos.length === 0) {
                contenedor.innerHTML = '<p style="color: var(--hada-pink); text-align: center;">üï∏Ô∏è No hay hadas registradas este mes...</p>';
                contadorSpan.innerText = '(0/10)';
                return;
            }
            
            let html = '';
            videos.forEach(video => {
                const embedHtml = generarEmbed(video.plataforma, video.videoId);
                const plataformaClase = video.plataforma === 'tiktok' ? 'platform-tiktok' : 'platform-youtube';
                const plataformaNombre = video.plataforma === 'tiktok' ? 'TikTok' : 'YouTube';
                
                html += `
                    <div class="entrada" data-id="${video.id}" data-tag="${video.tag}">
                        <div class="entrada-header">
                            <span class="entrada-titulo">
                                ${video.titulo}
                                <span class="platform-badge ${plataformaClase}">${plataformaNombre}</span>
                            </span>
                            <span class="entrada-fecha">${video.fecha}</span>
                        </div>
                        <div class="entrada-tags">
                            <span class="tag tag-${video.tag}">${obtenerNombreTag(video.tag)}</span>
                        </div>
                        ${embedHtml}
                        <div class="entrada-contenido">${video.contenido || ''}</div>
                        ${editorActivo ? `
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button onclick="editarVideo(${video.id})" class="btn-secondary">‚úèÔ∏è EDITAR</button>
                                <button onclick="eliminarVideo(${video.id})" class="btn-danger">üóëÔ∏è ELIMINAR</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
            contadorSpan.innerText = `(${videos.length}/${MAX_ENTRADAS_POR_MES})`;
        }
        
        function obtenerNombreTag(tag) {
            if (tag === 'hadas') return 'üßö HADAS MALVADAS';
            if (tag === 'avistamientos') return 'üîç AVISTAMIENTOS';
            if (tag === 'cazas') return '‚öîÔ∏è CAZAS EXITOSAS';
            return tag;
        }
        
        function editarVideo(id) {
            if (!editorActivo) return;
            
            const video = todosLosVideos.find(v => v.id == id);
            if (!video) return;
            
            document.getElementById('editId').value = video.id;
            document.getElementById('editTitulo').value = video.titulo;
            document.getElementById('editTag').value = video.tag;
            document.getElementById('editContenido').value = video.contenido || '';
            document.getElementById('editVideoUrl').value = video.url || '';
            document.getElementById('editPlataforma').value = video.plataforma;
            document.getElementById('editVideoId').value = video.videoId;
            
            // Mostrar panel si no est√° visible
            if (!editorActivo) {
                mostrarEditor(); // pero esto pedir√≠a clave otra vez, mejor aseguramos que editorActivo=true
            } else {
                document.getElementById('panelEditor').style.display = 'block';
                document.getElementById('btnMostrarEditor').style.display = 'none';
            }
            
            // Actualizar mensaje de plataforma detectada
            const msg = document.getElementById('plataformaDetectada');
            if (video.plataforma === 'tiktok') {
                msg.innerText = 'üì± Plataforma detectada: TikTok';
                msg.style.color = '#ff0050';
            } else if (video.plataforma === 'youtube') {
                msg.innerText = '‚ñ∂Ô∏è Plataforma detectada: YouTube';
                msg.style.color = '#ff0000';
            }
        }
        
        function eliminarVideo(id) {
            if (!editorActivo) return;
            if (confirm('¬øSeguro que quieres eliminar este avistamiento de hada?')) {
                todosLosVideos = todosLosVideos.filter(v => v.id != id);
                guardarVideos();
                if (filtroActivo === "todas") {
                    mostrarVideos(todosLosVideos);
                } else {
                    filtrarPorTag(filtroActivo);
                }
            }
        }
        
        // ============================================
        // ===== FILTROS =====
        // ============================================
        function filtrarPorTag(tag) {
            filtroActivo = tag;
            
            // Actualizar clases de botones
            document.querySelectorAll('.filtro-btn').forEach(btn => btn.classList.remove('activo'));
            document.getElementById(`filtro-${tag}`).classList.add('activo');
            
            let filtrados;
            if (tag === 'todas') {
                filtrados = todosLosVideos;
            } else {
                filtrados = todosLosVideos.filter(v => v.tag === tag);
            }
            mostrarVideos(filtrados);
        }
        
        // ============================================
        // ===== CONTADOR MES =====
        // ============================================
        function actualizarContadorMes() {
            const contadorDiv = document.getElementById('contadorMes');
            const total = todosLosVideos.length;
            const restantes = MAX_ENTRADAS_POR_MES - total;
            contadorDiv.innerHTML = `üßö HADAS CAZADAS ESTE MES: ${total} / ${MAX_ENTRADAS_POR_MES} (quedan ${restantes} cupos)`;
        }
        
        function nuevoMes() {
            if (editorActivo && confirm('¬øEst√°s segura de querer limpiar todo el registro? Esta acci√≥n no se puede deshacer.')) {
                todosLosVideos = [];
                guardarVideos();
                mostrarVideos(todosLosVideos);
                actualizarContadorMes();
            } else if (!editorActivo) {
                alert('üîí Debes estar en modo cazadora para limpiar el mes.');
            }
        }
        
        // ============================================
        // ===== INICIALIZACI√ìN =====
        // ============================================
        window.onload = function() {
            cargarVideos();
            // Inicialmente filtro 'todas' activo
            document.getElementById('filtro-todas').classList.add('activo');
        };
    </script>
</body>
</html>
