<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hadas Malvadas ¬∑ paulaflechadadeai</title>
    <style>
        /* Mismos estilos, solo cambian colores a tonos m√°s rosas/morados */
        :root {
            --neon-green: #00ff00;
            --neon-pink: #ff00ff;
            --neon-blue: #00aaff;
            --hada-pink: #ff88ff;
            --hada-purple: #cc66ff;
            --bg-dark: #0a0a0a;
            --bg-darker: #000;
        }

        body {
            font-family: 'Courier New', monospace;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: var(--bg-dark);
            color: var(--neon-green);
            line-height: 1.6;
            background-image: radial-gradient(circle at 10% 20%, rgba(255, 0, 255, 0.05) 0%, transparent 20%),
                              radial-gradient(circle at 90% 80%, rgba(255, 136, 255, 0.05) 0%, transparent 20%);
        }

        .header {
            border-bottom: 2px dashed var(--hada-pink);
            padding-bottom: 15px;
            margin-bottom: 30px;
            position: relative;
        }

        .glitch-title {
            font-size: clamp(1.8em, 5vw, 2.8em);
            color: var(--hada-pink);
            text-shadow: 3px 0 var(--hada-purple), -2px 0 var(--neon-green);
            animation: glitch 3s infinite;
            margin: 0;
        }

        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            10% { transform: translate(-3px, 1px); }
            20% { transform: translate(2px, -2px); }
            30% { transform: translate(-2px, 3px); }
            40% { transform: translate(1px, -1px); }
        }

        .subheader {
            color: var(--hada-pink);
            margin: 10px 0 0 0;
            font-size: 1em;
        }

        .terminal {
            background: var(--bg-darker);
            border: 2px solid var(--hada-pink);
            padding: 20px;
            margin: 30px 0;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.2);
        }

        .terminal-line {
            margin: 12px 0;
            font-family: 'Courier New', monospace;
        }

        .prompt { color: var(--hada-pink); font-weight: bold; }
        .cmd { color: var(--hada-purple); }
        .output { color: var(--neon-green); margin-left: 15px; }

        button {
            background: black;
            border: 2px solid;
            padding: 8px 16px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px currentColor;
        }

        .btn-primary { color: var(--hada-pink); border-color: var(--hada-pink); }
        .btn-secondary { color: var(--hada-purple); border-color: var(--hada-purple); }
        .btn-danger { color: #ff5555; border-color: #ff5555; }
        .btn-warning { color: #ffaa00; border-color: #ffaa00; }

        input, select, textarea {
            background: black;
            color: var(--neon-green);
            border: 2px solid var(--hada-pink);
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            width: 100%;
            margin-bottom: 15px;
            border-radius: 4px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--hada-purple);
            box-shadow: 0 0 10px var(--hada-purple);
        }

        label {
            color: var(--hada-pink);
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 5px;
            margin-bottom: 5px;
            color: black;
        }

        .tag-hadas { background: #ff88ff; }
        .tag-avistamientos { background: #cc66ff; }
        .tag-cazas { background: #ff55ff; }

        .entrada {
            border-left: 6px solid #ff88ff;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 0 8px 8px 0;
        }

        .entrada-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .entrada-titulo {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--hada-pink);
        }

        .entrada-fecha {
            color: var(--hada-purple);
            font-size: 0.85em;
        }

        .entrada-tags {
            margin: 10px 0;
        }

        .entrada-contenido {
            color: var(--neon-green);
            white-space: pre-wrap;
            border-top: 1px dashed #333;
            border-bottom: 1px dashed #333;
            padding: 15px 0;
            margin: 15px 0;
        }

        .tiktok-container {
            position: relative;
            width: 100%;
            margin: 20px 0;
            background: black;
            border-radius: 8px;
            overflow: hidden;
        }

        .tiktok-container iframe {
            width: 100%;
            height: 600px;
            border: none;
        }

        .url-preview {
            color: var(--hada-pink);
            font-size: 0.8em;
            word-break: break-all;
            margin: 5px 0;
            padding: 5px;
            background: rgba(0,0,0,0.5);
        }

        .contador-mes {
            background: rgba(255, 136, 255, 0.1);
            border: 1px solid var(--hada-pink);
            padding: 10px;
            text-align: center;
            font-size: 1.2em;
            margin: 20px 0;
        }

        .filtros {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
            justify-content: center;
        }

        .filtro-btn {
            background: black;
            border: 2px solid;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 20px;
        }

        .filtro-btn.activo {
            background: var(--hada-pink);
            color: black;
        }

        .volver {
            margin: 20px 0;
        }
        .volver a {
            color: var(--hada-pink);
            text-decoration: none;
            font-weight: bold;
        }
        .volver a:hover { color: var(--hada-purple); }

        @media (max-width: 768px) {
            body { padding: 10px; }
            .tiktok-container iframe { height: 400px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="glitch-title">~/hadasmalvadas $</h1>
        <p class="subheader">> Cazando hadas en TikTok ¬∑ 10 por mes ¬∑ Sin sponsors</p>
    </div>

    <div class="volver">
        <a href="/">‚Üê INICIO</a> ¬∑ 
        <a href="/observatorio">‚Üê OBSERVATORIO</a>
    </div>

    <!-- ===== PANEL EDITOR ===== -->
    <div id="panelEditor" style="display: none;" class="terminal">
        <div class="terminal-line">
            <span class="prompt">$</span> <span class="cmd">caza_hadas --activar</span>
        </div>
        
        <form id="formEditor" onsubmit="event.preventDefault(); guardarEntrada();">
            <div>
                <label>üìå T√çTULO:</label>
                <input type="text" id="editTitulo" placeholder="Ej: Hada avistada en live" required>
            </div>
            
            <div>
                <label>üè∑Ô∏è TAG:</label>
                <select id="editTag" required>
                    <option value="hadas">üßö HADAS MALVADAS</option>
                    <option value="avistamientos">üîç AVISTAMIENTOS</option>
                    <option value="cazas">‚öîÔ∏è CAZAS EXITOSAS</option>
                </select>
            </div>
            
            <div>
                <label>üîó URL DE TIKTOK:</label>
                <input type="url" id="editTiktokUrl" 
                       placeholder="https://www.tiktok.com/@hada/video/123456789" 
                       required>
                <small style="color: var(--hada-pink);">Pega la URL del video donde viste el hada</small>
            </div>
            
            <div id="vistaPreviaTiktok" style="display: none; margin: 15px 0; text-align: center;">
                <p style="color: var(--hada-pink);">üßö ¬°Hada detectada en el video!</p>
                <div class="url-preview" id="urlPreview"></div>
            </div>
            
            <div>
                <label>üìù NOTAS DE CAZA (opcional):</label>
                <textarea id="editContenido" rows="3" placeholder="Describe c√≥mo identificaste al hada..."></textarea>
            </div>
            
            <input type="hidden" id="editId" value="">
            <input type="hidden" id="editTiktokId" value="">
            
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button type="submit" class="btn-primary">üíæ REGISTRAR HADA</button>
                <button type="button" onclick="cancelarEdicion()" class="btn-secondary">‚úñ CANCELAR</button>
            </div>
        </form>
    </div>

    <!-- ===== BOTONES DE CONTROL ===== -->
    <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: space-between; margin: 20px 0;">
        <button onclick="mostrarEditor()" id="btnMostrarEditor" class="btn-secondary">
            üîß MODO CAZADORA
        </button>
        <button onclick="nuevoMes()" id="btnNuevoMes" class="btn-warning">
            üìÖ NUEVO MES (limpiar registro)
        </button>
    </div>

    <!-- ===== CONTADOR ===== -->
    <div class="contador-mes" id="contadorMes">
        Cargando...
    </div>

    <!-- ===== FILTROS ===== -->
    <div class="filtros">
        <button onclick="filtrarPorTag('todas')" id="filtro-todas" class="filtro-btn" style="border-color: var(--hada-pink); color: var(--hada-pink);">üìã TODAS</button>
        <button onclick="filtrarPorTag('hadas')" id="filtro-hadas" class="filtro-btn" style="border-color: #ff88ff; color: #ff88ff;">üßö HADAS</button>
        <button onclick="filtrarPorTag('avistamientos')" id="filtro-avistamientos" class="filtro-btn" style="border-color: #cc66ff; color: #cc66ff;">üîç AVISTAMIENTOS</button>
        <button onclick="filtrarPorTag('cazas')" id="filtro-cazas" class="filtro-btn" style="border-color: #ff55ff; color: #ff55ff;">‚öîÔ∏è CAZAS</button>
    </div>

    <!-- ===== CONTENEDOR DE VIDEOS ===== -->
    <div class="terminal">
        <div class="terminal-line">
            <span class="prompt">$</span> <span class="cmd">hadas --registro</span>
            <span id="contadorVideos" style="color: var(--hada-pink); margin-left: 15px;">(0/10)</span>
        </div>
        
        <div id="contenedorVideos" style="margin: 20px 0; min-height: 200px;">
            <p style="color: var(--hada-pink); text-align: center;">Cargando registro de hadas...</p>
        </div>
    </div>

    <div class="footer">
        <p>üìç Registro de Hadas Malvadas ¬∑ 10 videos por mes ¬∑ Peg√° la URL y a cazar</p>
        <p style="color: var(--hada-pink);">üßö‚Äç‚ôÄÔ∏è "Las hadas existen, solo hay que saber d√≥nde mirar"</p>
    </div>

    <script>
        // ============================================
        // ===== CONFIGURACI√ìN =====
        // ============================================
        // ‚ö†Ô∏è IMPORTANTE: Este archivo ser√° procesado por GitHub Actions
        // La l√≠nea de abajo ser√° REEMPLAZADA autom√°ticamente durante el despliegue
        const CLAVE_EDITOR = "___CLAVE_SECRETA_EDITOR___";
        const MAX_ENTRADAS_POR_MES = 10;
        
        let todosLosVideos = [];
        let editorActivo = false;
        let filtroActivo = "todas";
        
        // ============================================
        // ===== FUNCIONES DE TIKTOK =====
        // ============================================
        function extraerTikTokId(url) {
            if (!url) return null;
            if (/^\d+$/.test(url)) return url;
            
            const patrones = [
                /video\/(\d+)/,
                /\/embed\/(\d+)/,
                /\/player\/v1\/(\d+)/,
                /tiktok\.com\/.*?(\d{10,})/
            ];
            
            for (let patron of patrones) {
                const match = url.match(patron);
                if (match) return match[1];
            }
            return null;
        }
        
        function generarIframeTikTok(videoId) {
            if (!videoId) return '<p style="color: red;">‚ùå Hada perdida, ID inv√°lido</p>';
            
            return `
                <div class="tiktok-container">
                    <iframe 
                        src="https://www.tiktok.com/player/v1/${videoId}?music_info=1&description=1"
                        allow="fullscreen"
                        loading="lazy">
                    </iframe>
                </div>
            `;
        }
        
        // ============================================
        // ===== FUNCIONES DE DATOS =====
        // ============================================
        function cargarVideos() {
            const guardados = localStorage.getItem('hadasMalvadas');
            if (guardados) {
                todosLosVideos = JSON.parse(guardados);
            } else {
                // Datos de ejemplo
                todosLosVideos = [
                    {
                        id: Date.now() - 86400000,
                        titulo: "Primer hada avistada",
                        tag: "hadas",
                        contenido: "Apareci√≥ en un live de madrugada",
                        tiktokUrl: "https://www.tiktok.com/@scout2015/video/6718335390845095173",
                        tiktokId: "6718335390845095173",
                        fecha: formatearFecha(new Date(Date.now() - 86400000)),
                        timestamp: Date.now() - 86400000
                    }
                ];
                guardarVideos();
            }
            ordenarVideos();
            actualizarContadorMes();
            mostrarVideos(todosLosVideos);
        }
        
        function guardarVideos() {
            localStorage.setItem('hadasMalvadas', JSON.stringify(todosLosVideos));
            actualizarContadorMes();
        }
        
        function ordenarVideos() {
            todosLosVideos.sort((a, b) => b.timestamp - a.timestamp);
        }
        
        function formatearFecha(fecha) {
            const dia = fecha.getDate().toString().padStart(2, '0');
            const mes = (fecha.getMonth() + 1).toString().padStart(2, '0');
            const a√±o = fecha.getFullYear();
            const horas = fecha.getHours().toString().padStart(2, '0');
            const minutos = fecha.getMinutes().toString().padStart(2, '0');
            return `${dia}/${mes}/${a√±o} ${horas}:${minutos}`;
        }
        
        // ============================================
        // ===== FUNCIONES DEL EDITOR =====
        // ============================================
        function mostrarEditor() {
            const clave = prompt("üîë Clave de cazadora:");
            
            // La constante CLAVE_EDITOR ya tiene el valor inyectado por GitHub Actions
            if (clave === CLAVE_EDITOR) {
                editorActivo = true;
                document.getElementById('panelEditor').style.display = 'block';
                document.getElementById('btnMostrarEditor').style.display = 'none';
                document.getElementById('editId').value = "";
                document.getElementById('editTitulo').value = "";
                document.getElementById('editTag').value = "hadas";
                document.getElementById('editContenido').value = "";
                document.getElementById('editTiktokUrl').value = "";
                document.getElementById('editTiktokId').value = "";
                document.getElementById('vistaPreviaTiktok').style.display = 'none';
                
                if (filtroActivo === "todas") {
                    mostrarVideos(todosLosVideos);
                } else {
                    filtrarPorTag(filtroActivo);
                }
            } else if (clave !== null) {
                alert("‚ùå Clave incorrecta");
            }
        }
        
        function ocultarEditor() {
            editorActivo = false;
            document.getElementById('panelEditor').style.display = 'none';
            document.getElementById('btnMostrarEditor').style.display = 'inline-block';
            
            if (filtroActivo === "todas") {
                mostrarVideos(todosLosVideos);
            } else {
                filtrarPorTag(filtroActivo);
            }
        }
        
        function cancelarEdicion() {
            ocultarEditor();
        }
        
        // ============================================
        // ===== GUARDAR VIDEO =====
        // ============================================
        function guardarEntrada() {
            const id = document.getElementById('editId').value;
            const titulo = document.getElementById('editTitulo').value.trim();
            const tag = document.getElementById('editTag').value;
            const contenido = document.getElementById('editContenido').value.trim();
            const tiktokUrl = document.getElementById('editTiktokUrl').value.trim();
            
            if (!titulo || !tiktokUrl) {
                alert("‚ö†Ô∏è T√≠tulo y URL son obligatorios");
                return;
            }
            
            const tiktokId = extraerTikTokId(tiktokUrl);
            if (!tiktokId) {
                alert("‚ùå No se pudo detectar el hada en esa URL");
                return;
            }
            
            if (!id && todosLosVideos.length >= MAX_ENTRADAS_POR_MES) {
                alert(`‚ö†Ô∏è L√≠mite de ${MAX_ENTRADAS_POR_MES} hadas por mes alcanzado`);
                return;
            }
            
            const ahora = new Date();
            
            if (id) {
                for (let i = 0; i < todosLosVideos.length; i++) {
                    if (todosLosVideos[i].id == id) {
                        todosLosVideos[i].titulo = titulo;
                        todosLosVideos[i].tag = tag;
                        todosLosVideos[i].contenido = contenido;
                        todosLosVideos[i].tiktokUrl = tiktokUrl;
                        todosLosVideos[i].tiktokId = tiktokId;
                        break;
                    }
                }
                alert("‚úÖ Registro de hada actualizado");
            } else {
                const nuevoVideo = {
                    id: Date.now(),
                    titulo: titulo,
                    tag: tag,
                    contenido: contenido,
                    tiktokUrl: tiktokUrl,
                    tiktokId: tiktokId,
                    fecha: formatearFecha(ahora),
                    timestamp: ahora.getTime()
                };
                todosLosVideos.unshift(nuevoVideo);
                alert("üßö ¬°Hada registrada con √©xito!");
            }
            
            ordenarVideos();
            guardarVideos();
            
            if (filtroActivo === "todas") {
                mostrarVideos(todosLosVideos);
            } else {
                filtrarPorTag(filtroActivo);
            }
            
            ocultarEditor();
        }
        
        function editarVideo(id) {
            if (!editorActivo) return;
            
            const video = todosLosVideos.find(v => v.id == id);
            if (!video) return;
            
            document.getElementById('editId').value = video.id;
            document.getElementById('editTitulo').value = video.titulo;
            document.getElementById('editTag').value = video.tag;
            document.getElementById('editContenido').value = video.contenido || "";
            document.getElementById('editTiktokUrl').value = video.tiktokUrl;
            document.getElementById('editTiktokId').value = video.tiktokId;
            
            document.getElementById('vistaPreviaTiktok').style.display = 'block';
            document.getElementById('urlPreview').textContent = `ID del hada: ${video.tiktokId}`;
            
            document.getElementById('panelEditor').style.display = 'block';
            document.getElementById('btnMostrarEditor').style.display = 'none';
        }
        
        function eliminarVideo(id) {
            if (!editorActivo) return;
            
            if (confirm("‚ö†Ô∏è ¬øEliminar este registro de hada?")) {
                todosLosVideos = todosLosVideos.filter(v => v.id != id);
                guardarVideos();
                
                if (filtroActivo === "todas") {
                    mostrarVideos(todosLosVideos);
                } else {
                    filtrarPorTag(filtroActivo);
                }
            }
        }
        
        // ============================================
        // ===== MOSTRAR VIDEOS =====
        // ============================================
        function mostrarVideos(lista) {
            const contenedor = document.getElementById('contenedorVideos');
            
            if (lista.length === 0) {
                contenedor.innerHTML = '<p style="color: var(--hada-pink); text-align: center;">üßö No hay hadas registradas este mes</p>';
                return;
            }
            
            let html = '';
            
            for (let i = 0; i < lista.length; i++) {
                const v = lista[i];
                
                let colorTag = '#ff88ff';
                if (v.tag === 'avistamientos') colorTag = '#cc66ff';
                if (v.tag === 'cazas') colorTag = '#ff55ff';
                
                html += `
                    <div class="entrada" style="border-left-color: ${colorTag};">
                        <div class="entrada-header">
                            <span class="entrada-titulo">üßö ${v.titulo}</span>
                            <span class="entrada-fecha">${v.fecha}</span>
                        </div>
                        
                        <div class="entrada-tags">
                            <span class="tag tag-${v.tag}">#${v.tag}</span>
                        </div>
                `;
                
                html += generarIframeTikTok(v.tiktokId);
                
                if (v.contenido) {
                    html += `<div class="entrada-contenido">${v.contenido}</div>`;
                }
                
                if (editorActivo) {
                    html += `
                        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 10px;">
                            <button onclick="editarVideo('${v.id}')" class="btn-secondary">‚úèÔ∏è EDITAR</button>
                            <button onclick="eliminarVideo('${v.id}')" class="btn-danger">üóëÔ∏è ELIMINAR</button>
                        </div>
                    `;
                }
                
                html += `</div>`;
            }
            
            contenedor.innerHTML = html;
            actualizarContadorVideos(lista.length);
        }
        
        // ============================================
        // ===== FILTROS =====
        // ============================================
        function filtrarPorTag(tag) {
            filtroActivo = tag;
            
            document.querySelectorAll('.filtro-btn').forEach(btn => {
                btn.classList.remove('activo');
            });
            
            if (tag !== "todas") {
                document.getElementById(`filtro-${tag}`).classList.add('activo');
            } else {
                document.getElementById('filtro-todas').classList.add('activo');
            }
            
            if (tag === "todas") {
                mostrarVideos(todosLosVideos);
            } else {
                const filtradas = todosLosVideos.filter(v => v.tag === tag);
                mostrarVideos(filtradas);
            }
        }
        
        // ============================================
        // ===== FUNCIONES DEL MES =====
        // ============================================
        function actualizarContadorMes() {
            const total = todosLosVideos.length;
            const restantes = MAX_ENTRADAS_POR_MES - total;
            document.getElementById('contadorMes').innerHTML = 
                `üìä Este mes: ${total}/${MAX_ENTRADAS_POR_MES} hadas ¬∑ Quedan ${restantes} por cazar`;
        }
        
        function actualizarContadorVideos(total) {
            document.getElementById('contadorVideos').innerHTML = `(${total}/${MAX_ENTRADAS_POR_MES})`;
        }
        
        function nuevoMes() {
            if (!editorActivo) {
                alert("üîí Debes estar en modo cazadora");
                return;
            }
            
            if (confirm("‚ö†Ô∏è ¬øNUEVO MES? Esto borrar√° TODOS los registros de hadas.")) {
                const confirmacion = prompt("Escribe 'BORRAR HADAS' para confirmar:");
                if (confirmacion === "BORRAR HADAS") {
                    todosLosVideos = [];
                    guardarVideos();
                    mostrarVideos([]);
                    ocultarEditor();
                    alert("‚úÖ Listo para cazar nuevas hadas este mes");
                }
            }
        }
        
        // ============================================
        // ===== INICIALIZACI√ìN =====
        // ============================================
        
        document.getElementById('editTiktokUrl')?.addEventListener('input', function(e) {
            const url = e.target.value;
            const id = extraerTikTokId(url);
            
            if (id) {
                document.getElementById('editTiktokId').value = id;
                document.getElementById('vistaPreviaTiktok').style.display = 'block';
                document.getElementById('urlPreview').textContent = `üßö Hada detectada ¬∑ ID: ${id}`;
            } else {
                document.getElementById('vistaPreviaTiktok').style.display = 'none';
            }
        });
        
        cargarVideos();
        
        console.log('%cüßö Sistema de Caza de Hadas iniciado', 'color: #ff88ff; font-size: 16px;');
    </script>
</body>
</html>
