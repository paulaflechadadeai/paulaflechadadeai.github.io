name: Desplegar con clave secreta

on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write

    steps:
      - name: Descargar c√≥digo
        uses: actions/checkout@v4

      - name: üîç PASO 1 - Listar archivos HTML
        run: |
          echo "üìÇ ARCHIVOS HTML ENCONTRADOS:"
          find . -name "*.html" -type f | sort
          echo ""
          echo "üìÇ TOTAL:" $(find . -name "*.html" -type f | wc -l) "archivos"

      - name: üîé PASO 2 - Buscar el marcador
        run: |
          echo "üîé BUSCANDO '___CLAVE_SECRETA_EDITOR___' EN LOS ARCHIVOS:"
          grep -r "___CLAVE_SECRETA_EDITOR___" --include="*.html" . || echo "‚ùå NO SE ENCONTR√ì EL MARCADOR EN NING√öN ARCHIVO"

      - name: üîë PASO 3 - REEMPLAZAR con la clave secreta
        run: |
          echo "‚ö° REEMPLAZANDO MARCADOR POR LA CLAVE SECRETA..."
          find . -name "*.html" -type f -exec sed -i 's/___CLAVE_SECRETA_EDITOR___/${{ secrets.CLAVE_EDITOR }}/g' {} \;
          echo "‚úÖ REEMPLAZO COMPLETADO"

      - name: ‚úÖ PASO 4 - Verificar que se reemplaz√≥
        run: |
          echo "üîé VERIFICANDO QUE EL MARCADOR YA NO EXISTE:"
          grep -r "___CLAVE_SECRETA_EDITOR___" --include="*.html" . && echo "‚ùå EL MARCADOR TODAV√çA EXISTE" || echo "‚úÖ MARCADOR ELIMINADO CORRECTAMENTE"
          
          echo ""
          echo "üîé BUSCANDO LA NUEVA CLAVE (primeros 4 caracteres):"
          grep -r "${{ secrets.CLAVE_EDITOR }}" --include="*.html" . | head -5 || echo "‚ùå NO SE ENCONTR√ì LA CLAVE INYECTADA"

      - name: üöÄ Desplegar a GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./
